# Eureka自我保护模式

## 什么是自我保护模式

默认情况下，EurekaClient会定时向EurekaServer发送心跳包(默认30秒)。如果EurekaServer在一定时间内没有接受到某个微服务的心跳，会注销该实例(默认90秒)。

但是EurekaServer在短时间内丢失过多客户端的时候，就会进入**自我保护模式**。在这种模式下，没有接受到心跳的微服务，EurekaServer不会立即注销。



## 为什么需要自我保护模式

在网络分区故障发生(延迟，卡顿，拥挤)时，微服务和EurekaServer无法正常通信，这就会导致EurekaServer在一定时间内无法接收到该微服务的心跳，从而注销掉这个微服务。

实际上，这是不太合理的。因为此时微服务本身是健康的，**不应该注销该微服务**。开启自我保护模式，能够保证业务的高可用。

它的设计哲学就是：宁愿保留错误的服务注册信息，也不盲目注销任何可能健康的服务实例。

自我保护模式是一种应对网络异常的安全保护措施。使用自我保护模式，能够让Eureka集群更加的健壮，稳定。



## 关闭自我保护模式

在EurekaServer服务做如下配置(默认为true，表示开启自我保护模式)

```yml
eureka:
  server:
    enable-self-preservation: false
```

